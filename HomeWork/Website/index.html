<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>My Movies</title>
    <link href="styles/style.css" rel="stylesheet" />
    <script src="dataBase/movies-db.js"></script>
    <script src="scripts/ajaxCalls.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <script src="scripts/shared.js"></script>
    <script>
        $(document).ready(renderMovies);

        function renderMovies() {
            const moviesContainer = $('#moviesContainer');
            const title = $('#title');

            $('#loadBtn').click(function () {
                $(this).hide();
                title.text("All Movies");
                moviesContainer.empty();
                renderMovieCards('Add to Cart', addToCart, moviesContainer, movies);
            });
        }

        function addToCart(movieId) {
            const movie = movies.find(movie => movie.id === movieId);
            const movieToSend = {
                id: 1,
                url: movie.url,
                primaryTitle: movie.primaryTitle,
                description: movie.description,
                primaryImage: movie.primaryImage,
                year: movie.startYear,
                releaseDate: movie.releaseDate,
                language: movie.language,
                budget: movie.budget,
                grossWorldwide: movie.grossWorldwide,
                genres: Array.isArray(movie.genres) ? movie.genres.join(",") : movie.genres,
                isAdult: movie.isAdult,
                runtimeMinutes: movie.runtimeMinutes,
                averageRating: movie.averageRating,
                numVotes: movie.numVotes
            };
            sendToServer(movieToSend);
        }

        function sendToServer(movie) {
            ajaxCall(
                'POST',
                urlAddToCart,
                JSON.stringify(movie),
                (response) => handleSuccess(
                    response,
                    '🎉 Success! The movie has been added to your cart. You can view it in "My Movies".',
                    'ℹ️ This movie is already in your cart. No duplicate entries allowed.'
                ),
                (error) => handleError(
                    error
                )
            );
        }
    </script>
</head>
<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="MyMovies.html">My Movies</a>
        </nav>
    </header>
    <div class="container">
        <div id="notification" class="notification"></div>
        <button id="loadBtn">Load Movies</button>
        <h1 id="title"></h1>
        <div id="moviesContainer"></div>
    </div>
</body>
</html>
