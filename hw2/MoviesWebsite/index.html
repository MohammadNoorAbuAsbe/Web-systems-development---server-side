<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="styles/style.css" rel="stylesheet" />
    <script src="scripts/movies-db.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <script src="scripts/ajaxCalls.js"></script>
    <script>
        $(document).ready(renderMovies);


        function renderMovies() {
          
            const moviesContainer = $('#moviesContainer');
            const title = $('#title');


            $('#loadBtn').click(function () {
                $(this).hide();
                title.text("All Movies");
                moviesContainer.empty();
                // Render Movies
                movies.forEach(function (movie) {
                    const movieCard = `
                                        <div class="movie-card">
                                            <img src="${movie.primaryImage}" alt="${movie.primaryTitle}">
                                            <h3>${movie.primaryTitle} (${movie.startYear})</h3>
                                            <p>${movie.description}</p>
                                            <button class="btn" onclick="sendToServer('${movie.id}')">Add to Cart</button>
                                        </div>
                                        `;
                    moviesContainer.append(movieCard);
                });
            });
        }
        
        
       
        function sendToServer(movieId) {

            const movie = movies.find(m => m.id == movieId) 

            const movieToSend = {
                Id: movie.id,
                Url: movie.url,
                PrimaryTitle: movie.primaryTitle,
                Description: movie.description,
                PrimaryImage: movie.primaryImage,
                Year: movie.endYear,
                ReleaseDate: movie.releaseDate,
                Language: movie.language,
                Budget: movie.budget,
                GrossWorldwide: movie.grossWorldwide,
                Genres: movie.genres,
                IsAdult: movie.isAdult,
                RuntimeMinutes: movie.runtimeMinutes,
                AverageRating: movie.averageRating,
                NumVotes: movie.numVotes
            }
            const port = 7284
            const url = `https://localhost:${port}/api/Movies`;
            console.log(movie)
            console.log(movieToSend)
            ajaxCall("POST", url, JSON.stringify(movieToSend), insertSCB, insertECS)
           
        }
        function insertSCB(res) {
            console.log(res);
        }

        function insertECS(err) {
            console.log(err);
        }

    </script>
</head>
<body>
    <header>
        <nav>
            <a href="index.html">Home</a>
            <a href="MyMovies.html">My Movies</a>
        </nav>
    </header>
    <div class="container">
        <button id="loadBtn">Load Movies</button>
        <h1 id="title"></h1>
        <div id="moviesContainer"></div>
    </div>

</body>
</html>